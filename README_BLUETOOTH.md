# نظام التحكم بالبلوتوث HC-05

## نظرة عامة

تم تطوير نظام بلوتوث محسن للتحكم في الأجهزة الإلكترونية عبر وحدة HC-05. النظام يدعم:

- ✅ البحث عن أجهزة البلوتوث
- ✅ الاتصال التلقائي بـ HC-05
- ✅ إرسال الأوامر النصية
- ✅ استقبال البيانات في الوقت الفعلي
- ✅ واجهة مستخدم عربية سهلة الاستخدام
- ✅ معالجة الأخطاء المتقدمة

## الميزات الجديدة

### 1. واجهة مستخدم محسنة
- عرض حالة الاتصال بشكل واضح
- مؤشرات بصرية لحالة البلوتوث
- رسائل تنبيه باللغة العربية

### 2. إدارة الاتصال المتقدمة
- اكتشاف تلقائي للخدمات والخصائص
- معالجة حالات الاتصال المختلفة
- إعادة الاتصال التلقائي عند انقطاعه

### 3. إرسال واستقبال البيانات
- إرسال أوامر نصية مع إضافة `\n` تلقائياً
- عرض البيانات المستلمة مع الوقت
- إمكانية مسح البيانات المستلمة

## كيفية الاستخدام

### الخطوة 1: تشغيل التطبيق
```bash
flutter run
```

### الخطوة 2: البحث عن الأجهزة
1. اضغط على "Scan for Devices"
2. انتظر حتى يكتمل البحث
3. ابحث عن جهاز HC-05 في القائمة

### الخطوة 3: الاتصال
1. اضغط على "Connect" بجانب HC-05
2. انتظر رسالة "Connected"
3. ستظهر واجهة التحكم

### الخطوة 4: إرسال الأوامر
1. اكتب الأمر في حقل النص (مثل: `LED_ON`)
2. اضغط "Send"
3. ستظهر رسالة تأكيد الإرسال

### الخطوة 5: مراقبة البيانات
- البيانات المرسلة تظهر باللون الأزرق
- البيانات المستلمة تظهر باللون الأخضر
- يمكن مسح البيانات بالضغط على "Clear"

## الأوامر المقترحة

### أوامر LED:
```
LED_ON      # تشغيل LED
LED_OFF     # إطفاء LED
LED_TOGGLE  # تبديل حالة LED
```

### أوامر الحالة:
```
STATUS      # طلب حالة النظام
VERSION     # طلب إصدار البرنامج
RESET       # إعادة تشغيل النظام
```

### أوامر مخصصة:
```
MOTOR_FORWARD   # تحريك المحرك للأمام
MOTOR_BACKWARD  # تحريك المحرك للخلف
MOTOR_STOP      # إيقاف المحرك
SENSOR_READ     # قراءة قيمة المستشعر
```

## إعدادات Arduino

### الكود المطلوب:
```cpp
#include <SoftwareSerial.h>

SoftwareSerial bluetooth(2, 3); // RX, TX

void setup() {
  Serial.begin(9600);
  bluetooth.begin(9600);
  
  // إعداد الأرجل
  pinMode(13, OUTPUT); // LED
  pinMode(9, OUTPUT);  // Motor 1
  pinMode(10, OUTPUT); // Motor 2
}

void loop() {
  if (bluetooth.available()) {
    String command = bluetooth.readString();
    command.trim();
    
    // معالجة الأوامر
    if (command == "LED_ON") {
      digitalWrite(13, HIGH);
      bluetooth.println("LED turned ON");
    }
    else if (command == "LED_OFF") {
      digitalWrite(13, LOW);
      bluetooth.println("LED turned OFF");
    }
    else if (command == "MOTOR_FORWARD") {
      analogWrite(9, 255);
      analogWrite(10, 255);
      bluetooth.println("Motor moving forward");
    }
    else if (command == "MOTOR_STOP") {
      analogWrite(9, 0);
      analogWrite(10, 0);
      bluetooth.println("Motor stopped");
    }
    else if (command == "STATUS") {
      bluetooth.println("System OK - Arduino running");
    }
    else {
      bluetooth.println("Unknown command: " + command);
    }
  }
}
```

### التوصيلات:
```
HC-05 VCC → 5V
HC-05 GND → GND
HC-05 TX → Arduino Pin 2 (RX)
HC-05 RX → Arduino Pin 3 (TX)
```

## حل المشاكل

### مشكلة: لا يتم العثور على HC-05
**الحل:**
1. تأكد من تشغيل HC-05
2. اضغط على زر EN لمدة 3 ثوانٍ
3. تأكد من أن LED يومض

### مشكلة: فشل الاتصال
**الحل:**
1. تأكد من كلمة المرور (1234)
2. أعد تشغيل HC-05
3. تأكد من عدم وجود اتصال سابق

### مشكلة: لا يتم إرسال البيانات
**الحل:**
1. تأكد من التوصيلات الصحيحة
2. تحقق من سرعة الاتصال (9600 baud)
3. أعد تشغيل Arduino

## الأمان

- النظام يستخدم كلمة مرور افتراضية: `1234`
- يمكن تغيير كلمة المرور باستخدام أوامر AT
- البيانات تُرسل بدون تشفير (نص عادي)

## التطوير المستقبلي

- [ ] دعم تشفير البيانات
- [ ] إضافة أوامر صوتية
- [ ] دعم أجهزة بلوتوث متعددة
- [ ] حفظ سجل الأوامر
- [ ] إضافة مؤقتات للأوامر

## الدعم

إذا واجهت أي مشاكل:

1. راجع ملف `BLUETOOTH_TROUBLESHOOTING.md`
2. تأكد من التوصيلات الصحيحة
3. جرب إعادة تشغيل الأجهزة
4. تحقق من إعدادات البلوتوث

## الترخيص

هذا المشروع مفتوح المصدر ومتاح للاستخدام الشخصي والتعليمي.
